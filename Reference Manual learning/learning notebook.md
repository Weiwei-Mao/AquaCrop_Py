## Chapter 1
### 1.1 From the Ky approach to the AquaCrop model
采用经验公式来表述作物产量与蒸散发的关系，及下列公式
$$
(1-Y/Y_x)=K_y(1-ET/ET_x) \tag{1.1a}
$$
$Y$ 和 $Y_x$ 为最大和实际产量

在AquaCrop中，还采用了一下两种处理
*  将实际蒸散发 $ET$ 划分为土壤蒸发 $T$ 和作物蒸腾 $Tr$
*  最终产量 $Y$ 由生物量$B$和收获系数 $HI$ 确定
$$Y=HI*B \tag{1.1b}$$

以上第一点避免了没有用于作物生产的耗水（土壤蒸发）对结果造成的影响，第二点则使得模型可以区分很多环境条件对最终结果的影响。不同环境变化影响下面的方程，而该方程在AquaCrop作物生长模块中非常重要，
$$B=WP* \sum Tr \tag{1.1c}$$
其中 $Tr$ 是蒸腾量（mm），$WP$ 是水分生产参数（单位面积蒸发每mm水，所产生的生物量）。

方程1.1c被插入到了很多个模块中，有*the soil* 模块（水均衡），*the crop* 模块（作物生长、产量）和*atmosphere* 模块（热、降雨、蒸发需求、二氧化碳浓度等）。此外，还有一些*management* 模块（比如*irrigation, fertilization, mulches, weeds* 等）可考虑了，因为他们可以影响水均衡、作物生长，并因此影响到最终的产量。此外，AquaCrop还可以描述气候变化下的情况。

以下是AquaCrop与其他作物模型的详细的区别
* 重点关注水；
* 采用覆盖度（canopy cover）而非叶面积指数（leaf area index）；
* 水分生产率（WP）规则化于？（normalized for）大气蒸发需求和二氧化碳浓度，由此增加了模型对于考虑不同地点、季节、气候、未来气候变化的能力；
* 参数数目相对少；
* 输入仅需要明确的，且可以最直接获取的参数和变量；
* 用户界面友好；
* 在计算精度、模型复杂度和鲁棒性（简单理解，也就是耐操）间取得平衡；
* 在世界范围内的不同农业系统中均有良好的适用性。

AquaCrop模型相对简单，主要包含作物生产和对水分匮缺的相应两大部分，图示如下
<img src=".\Figs\Fig1.1b.png" width="500px" />

最后，尽管有很多其他的作物模型，AquaCrop表示，1、别人的很复杂；2、很少被FAO的目标用户采用（FAO这么说是不是难以服众？）；3、别人的需要大量的变量和输入参数，对于全球各种各样的位置作物等，这些并不容易获得，且这些参数（如LAI、leaf water potential,叶面水势？）对研究人员更加友好，而不是终端用户；4、不充分的透明度？和简单的模型结构，使终端用户更好接受。

### 1.2 AquaCrop操作
### 1.2.1 计算方案
总的计算方案如下图所示，
<img src=".\Figs\Fig1.2a.png" width="500px" />

根系层中存储的水份，采用边界进出通量来计算。由根系层水分消耗确定水分胁迫的大小，其影响（a）覆盖度的增加，（b）冠层的衰退和老化，（c）根系继续扎根速率，（d）气孔导度，和之后的腾发量，（e）收获系数HI。冷的温度胁迫（f）减小作物腾发，而高温和低温都胁迫（f）抑制授粉和减小收获系数HI。

按天为时间步，模型模拟以下过程
1. 作物生长（Crop development）。在作物生长的模拟中，冠层扩张和根系层扩张是分开的两个过程。实际相互依赖的发芽与生根过程，在模型中通过水分胁迫间接联系在一起。AquaCrop采用CC（green Canopy Cover）描述作物生长，这是模型非常重要的一个变量。通过CC的各种变化，确定Tr，Tr又确定生物量B和最终的产量Y。产生水分胁迫时，CC和根系深度均会小于无胁迫时的最大值（废话）。
2. 腾发（Tr）。Tr = evaporating power * 作物系数$Kc_{Tr}$。$Kc_{Tr}$与CC成正比，因此需要不断调整。evaporating power采用FAO P-M公式计算。水分胁迫不但影响冠层生长，还会导致气孔关闭，并直接影响到腾发。CC和持续时间代表腾发的来源，而气孔导度则代表腾发强度。
3. 地上生物量B。Tr通过1.1c转化为B。AquaCrop中，WP对大气蒸发需求和二氧化碳浓度呈正态分布？该模型生物量是地上一个总的，没有划分各个器官。
4. 产量Y形成。公式1.1b。HI与水分和温度胁迫有关。

水分、温度影响上述多个过程。此外，模型还考虑了土壤肥力、盐分的胁迫对冠层生长、腾发、生物量产生的影响。

### 1.2.2 水均衡
将根系层看成是一个reservoir，进入项有rainfall、irrigation、capillary rise；流出项有runoff、evapotranspiration、deep percolation。仍然保持在根系层中的水是Wr，消耗的是Dr。

AquaCrop按天计算，在空间上将根系层分为12层。

水分胁迫用Ks表示，在根系层消耗所需的上阈值（田持）之上时，Ks=1；小于下阈值（永久凋萎点）时，Ks=0；在她们之间是一条曲线。因为每个过程中，Ks的影响都不一样，所以每个过程的阈值取值也不一样。

### 1.2.3 Step 1 —— CC的模拟
CC是指green canopy cover占地面的比例。最优条件下作物冠层的生长，仅需要很少的作物参数，从最开始的crop file中获取
* 90%出苗时的初始冠层覆盖度，$CC_0$;
* 充分生长后，最大的冠层覆盖度，$CC_x$;
* 冠层生长系数（CGC），用于描述从出苗到最大冠层的生长；
* 冠层衰退系数（CDC），用于描述进入成熟期后冠层的衰退。

一个作物周期中，CC的变化如下图所示，
<img src=".\Figs\Fig1.2d.png" width="500px" />

当水分匮缺时，会导致提前的叶面衰老，因此1.2.2中所说的上阈值会变小很多。衰老的程度由冠层早期衰老的水分匮缺系数$Ks_{sen}$来描述，这个系数将会修正CDC的值。由于冠层早期衰老，作物的生命可能会急剧缩短。见下图所示，理想状况与实际计算情况。
<img src=".\Figs\Fig1.2e.png" width="500px" />

AquaCrop中其他的影响CC的因素有，
* 气温。温度通过有效积温（growing degree days，GDD）来施加影响。为计算GDD，需要一个基础温度（低于该温度作物不生长）和一个最高温度（高于这个温度，作物也不会在增长）。
* 矿物元素匮缺。AquaCrop并不模拟养分循环和均衡，但是提供一个土壤养分匮缺系数（Ks）。通过对于叶子扩展的土壤肥力系数$Ks_{exp,f}$影响CGC，通过土壤肥力对最大覆盖度的影响系数$Ks_{CCx}$影响$CC_x$。在生长和最大覆盖度达到之后的阶段，模型给一个稳定的每天下降系数$f_{CDecline}$。
* 盐分胁迫。过程和肥差不多。

### 1.2.4 Step 2 —— Tr的模拟
$$
Tr=Ks * KS_{Tr} * (Kc_{Tr,x} CC*)*ET_{0} \tag{1.2a}
$$
$ET_{0}$由P-M公式计算，蒸发系数（$Kc_{Tr}=Kc_{Tr,x}CC*$）正比于CC，计算过程中持续调整。比例系数（$Kc_{Tr,x}$）包含了作物与P-M计算的参考作物的所有不同点。1.2a中采用CC*取代CC，是因为为了描述作物行间微小的对流作用，使得作物蒸腾可以利用额外的能量。当冠层没有发育完整时，这部分能量的贡献是非常可观的。

水分过多或者匮缺都会减小蒸腾，通过水分匮缺系数Ks施加影响。当水分匮缺使气孔关闭，则会考虑一个气孔关闭系数（$Ks_{sto}$），当水分过多导致缺氧，则考虑一个积水系数（$Ks_{aer}$）。当水分匮缺最大时，完全抑制蒸腾。

盐分存在增加了水分匮缺对气孔关闭系数的影响，在模型中，通过额外的系数($Ks_{sto,salt}$)来减小$Ks_{sto}$。

低温会影响气孔导度，通过影响$Ks_{Tr}$实现。

### 1.2.5 Step 3 —— B的模拟


