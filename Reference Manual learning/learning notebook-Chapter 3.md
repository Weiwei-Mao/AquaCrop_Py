# Chapter 3 计算流程
## 3.1 根系层储水
### 3.1.1 进出水量
如下图所示。水分通过降雨和灌溉进入储水体。当降雨强度太大时，会产生地表径流，只有一部分水分入渗。入渗的水分不会一直在根系层，部分水分作为深层渗漏流出根系层。水分也可以通过毛管上升从下边界进入储水体。作物蒸腾和土壤蒸发则使得水分流出储水体。
<img src=".\Figs\Fig3.1a.png" width="500px" />

### 3.1.2 储存的土壤水和土壤水分亏缺
当计算土壤水均衡时，土体中存储的水量可以被表示为储水量W或水分消耗量D。
<img src=".\Figs\Fig3.1b.png" width="500px" />

* **采用等效水深表示土壤中存储水量**

采用等效水深表示土壤中存储水量的好处是，降雨蒸发等也是用单位面积水深表示的，因此在计算水均衡的时候非常方便。
$$
Wr = 1000 \theta Zr(1-\frac {{Vol\%}_{gravel}} {100}) \tag{Eq. 3.1a}
$$
其中，Wr，根系层的土壤含水率，以深度表示，mm；
$\theta$，体积含水率，[m3水/m3土]；
Zr，有效根系深度，m；
${Vol\%}_{gravel}$，根系层中砾石的体积百分率；

表层中存储的水以深度表示为，
$$
W_{Ztop} = 1000 \theta_{top} Ztop(1-\frac {{Vol\%}_{gravel}} {100}) \tag{Eq. 3.1b}
$$
其中，W_{Ztop}，表层的土壤含水率，以深度表示，mm；
$\theta_{top}$，体积含水率，[m3水/m3土]；
Ztop，表层深度，m；
${Vol\%}_{gravel}$，表层中砾石的体积百分率；

* **土壤水亏缺**

水分亏缺是距离田持所缺少的水分量。田持定义为重力作用下土壤最大持水量。
根系层水分亏缺可以表示为：
$$
Dr = Wr_{FC}-Wr = 1000 (\theta_{FC}-\theta) Zr(1-\frac {{Vol\%}_{gravel}} {100}) \tag{Eq. 3.1c}
$$
其中，Dr，根系层水分亏缺，mm；
Wr_{FC}，根系层田持含水量，mm，$=1000\theta_{FC}Zr(1-Vol\%_{graval}/100)$;
Wr，根系层土壤含水量，以水深表示，mm；
$\theta_{FC}$，田持含水率；
$\theta$，根系层平均含水率；
同理可以获得表层土壤的水分亏缺，
$$
D_{Ztop} = W_{top,FC}-W_{Ztop} = 1000 (\theta_{top,FC}-\theta_{top}) Ztop(1-\frac {{Vol\%}_{gravel}} {100}) \tag{Eq. 3.1d}
$$
各项含义不在一一解释。

当有较大降雨或灌溉时，会导致根系层水分亏缺为负值。

* **Total Available soil Water可利用土壤水总量**

可利用土壤水总量是作物理论上可以从土壤中提取的水的总量。因此（1）超过田持的部分，土壤不能维持因而排掉；（2）小于永久凋萎点时，土壤水吸附在土壤基质上难以被根系吸收，因此Total Available soil Water是在永久凋萎点和田持之间的水量，即
$$
TAW = 1000(\theta_{FC}-\theta_{WP})Z(1-\frac {{Vol\%}_{gravel}} {100})=W_{FC}-W_{PWP} \tag{Eq.3.1e}
$$
其中，TAW，研究土体中，总的可用土壤水，mm；
$\theta_{FC}$，田持含水率；
$\theta_{WP}$，永久凋萎点；
Z，研究土体深度，m；
$W_{FC}$，田持时土壤含水量，以水深表示，mm；
$W_{PWP}$，永久凋萎点时土壤含水量，以水深表示，mm；

## 3.2 胁迫
作物生长可能受到的胁迫作用有，水分胁迫、温度胁迫、肥力胁迫、盐分胁迫
### 3.2.1 胁迫相应函数
胁迫对作用生长的影响采用胁迫系数Ks来描述。本质上，Ks是一个目标模型参数的修正项，变化范围在0（完全胁迫）到1（无胁迫）之间。在胁迫上限指标之上时，并不存在胁迫现象，Ks取为1；相反，在胁迫下限之下时，Ks取为0。
<img src=".\Figs\Fig3.2a.png" width="500px" />

相对胁迫水平($S_{rel}$)和Ks曲线的形状决定了胁迫影响的大小。胁迫曲线的形状可以是线性的、凸面的或对数的。

**线性**
$$
Ks=1-S_{rel} \tag{Eq.3.2a}
$$
**凸面**
胁迫作用较大时影响才会比较显著。
$$
Ks=1-\frac {e^{S_{rel}f_{shape}}-1} {e^{f_{shape}}-1} \tag{Eq.3.2b}
$$
$S_{rel}$是相对胁迫水平，$f_{shape}$是形状因子，对于凸面曲线，形状因子大于0。
**对数**
$$
Ks=\frac {S_nS_x} {S_n+(S_x-S_n)exp^{-r(1-S_{rel})}} \tag{Eq.3.2c}
$$
其中$S_n$和$S_x$分别是下和上相对胁迫水平的界限，r是比率因子。根据Ks在曲线中间位置时为0.5，并给定$S_n$和$S_x$，即可求出r，即将$Ks=0.5$和$S_{rel}=0.5$带入方程。因为$S_{rel}$在下界限处为0，因此应该给一个相对较小的$S_n$的值。

### 3.2.2 水分胁迫
**水分胁迫系数**
水分胁迫影响冠层发育和根系层生长，导致气孔关闭，降低蒸腾速率，改变收获指数。如果水分胁迫过于严重，会导致作物授粉失败，并会导致冠层早衰。AquaCrop考虑的作物水分胁迫系数及其影响见表3.2a所示，

土壤水分胁迫的指标是采用TAW的消耗比例来表示。当土壤水分的消耗超过$p_{upper}TAW$时，开始产生水分胁迫。当土壤水分消耗至下限$p_{lower}TAW$时，胁迫最大。土壤水分胁迫影响的每个过程，都有其各自的上下限。比如对于叶子和相应的冠层生长，其下限在PWP之上，但是对于气孔，冠层衰老和授粉，其下限则固定在PWP。Ks曲线的形状是线性或者图形的。

因此胁迫相应曲线是针对蒸发能力ET0为5 mm/day时定义的，因此对于ET0，其水分胁迫的上下限需要调整，
$$
0 \le p_{adj}=p_{given}+f_{adj}(0.04(5-ET0))(log_{10}(10-9p_{given}))\le 1 \tag{Eq.3.2d}
$$
其中$f_{adj}$时程序中的一个参数，用于调整，在大于1时增强，小于1时减弱。方程中的log项使得该参数在土壤湿润时的调整幅度比干旱时的调整幅度大，因为当土壤干旱时，可能存在对气孔和蒸发的限制（因此对于蒸发能力ET0影响更小）。
<img src=".\Figs\FigTable3.2a.png" width="500px" />

**土壤水分胁迫的确定**
对于深根作物，在小雨之后为了减小其水分胁迫，在每个计算时间布将根系层消耗水量（Dr）与表层土壤消耗水量（Dztop）对比。通过对比得知土壤剖面中哪一部分最湿润，控制着水分胁迫的大小。为了Dr和Dztop能进行对比，将它们转化为与相应TAW的比值，见图3.2c
<img src=".\Figs\Fig3.2c.png" width="500px" />
如果Dr小于Dztop，那么根系层相对较干，决定着水分胁迫的大小。通过对比根系层水量Wr与土壤含水量的界限，获得水分胁迫对叶片（包括气孔关闭和早衰）的影响，并模拟相应的作物反应。

如果Dztop小于Dr，那么表土比整个根系层土壤更加湿润。因此采用表土的含水量确定各个胁迫系数。其中表土的深度为一个模型参数，可以由用户更改。

### 3.2.3 气温胁迫
作物蒸腾和授粉都会被气温胁迫所影响。AquaCrop考虑的气温胁迫系数及其影响，见表格3.2所示。
<img src=".\Figs\FigTable3.2b.png" width="500px" />

对上表中的第二项，当气温低于下界限时，气温胁迫会完全抑制以上三个过程，及Ks=0，当大于上界限时，没影响。对上表中的第三项则完全相反。这两个温度胁迫曲线都是对数形式的。

### 3.2.4 肥力胁迫
肥力影响冠层生长和生物量的生成。AquaCrop考虑的肥力影响的过程及参数见表3.2c所示。
<img src=".\Figs\FigTable3.2c.png" width="500px" />


### 3.2.5 盐分胁迫
盐分胁迫可能会影响生物量生产，盐分胁迫系数为$Ks_{salt}$
<img src=".\Figs\Fig3.2f.png" width="500px" />

根系层土壤饱和提取液的平均电导率（ECe）是盐分胁迫的控制指标。

为了模拟盐分对生物量（B）的影响。AquaCrop考虑一系列的胁迫系数，（i）影响冠层生长；（ii）影响气孔关闭，见Table 3.2e所示。除了三个胁迫系数以外，AquaCrop还考虑了衰退系数$f_{CDecline}$，也是胁迫指标，用来修正模型参数。当根系层干了的情况下，为了考虑存留的盐分的影响，通过考虑根系层水分平均电导率的影响来调整$Ks_{sto,salt}$的值。
<img src=".\Figs\FigTable3.2e.png" width="500px" />

## 3.3 Growing Degree Days
高温采用有效积温（Growing Degree-Days，GDD）表达，在AquaCrop里用来描述作物的生长。这种方法是，某一个过程持续的时间并不是采用天数来表示的，而是采用GDD来表示。

GDD的计算方法是采用平均温度（$T_{avg}$）减去基础温度（$T_{base}$），
$$
GDD = T_{avg}-T_{base} \tag{Eq. 3.3a}
$$
<img src=".\Figs\Fig3.3.png" width="500px" />
基础温度的意思是，当温度低于（$T_{base}$）时，作物不能生长发育。在AquaCrop中还有一个上限温度（$T_{upper}$）值。当高于上限温度值时，作物生长发育也不会再进一步增长。

McMaster and Wilhelm (1997)提出了两种计算$T_{avg}$的方法，方法1主要被用来计算细粒谷类作物，如小麦和大麦，而方法2较多被用来计算玉米的GDD，当然也被用于其他作物。在AquaCrop中还提供了第3种方法。

### 3.3.1 方法1
$$
T_{avg} = \frac {(T_{x}+T_{n})} 2 \tag{Eq. 3.3b}
$$
其中$T_x$和$T_n$分别是日最大和最小气温。计算GDD，首先检查$T_{avg}$是否在$T_{base}$和$T_{upper}$之间。如果小于$T_{base}$，则设置为$T_{base}$，此时当天的GDD是0。如果大于$T_{upper}$，则设置为$T_{upper}$，当天结果为$T_{upper}$-$T_{base}$。

### 3.3.2 方法2
在该方法中，首先检查$T_x$和$T_n$是不是在$T_{base}$和$T_{upper}$之间。然后予以调整，之后再进行计算，
$$
T_{avg} = \frac {(T_{x}^*+T_{n}^*)} 2 \tag{Eq. 3.3c}
$$
其中$T_x^*$和$T_n^*$分别是调整后的日最大和最小气温。调整根据以下规则
* $T_x^*$是最大的气温，如果$T_x$大于$T_{upper}$，则$T_x^*=T_{upper}$；如果$T_x$小于$T_{base}$，则$T_x^*=T_{base}$；
* $T_n^*$是最小的气温，如果$T_n$大于$T_{upper}$，则$T_n^*=T_{upper}$；如果$T_n$小于$T_{base}$，则$T_n^*=T_{base}$；

### 3.3.3 方法3
同2方法，在计算前予以检验，但是只检验最大温度。
$$
T_{avg} = \frac {(T_{x}^*+T_{n})} 2 \tag{Eq. 3.3d}
$$
其中$T_x^*$是调整后的日最大气温,$T_n$是最小气温。最大温度调整规则同上。

## 3.4 Green canopy cover for optimal conditions
### 3.3.4 Green canopy cover throughout the crop cycle
作物冠层在最优条件下的生长与衰老过程由以下四个参数描述，
* $CC_o$：90%出芽率的时候的作物冠层覆盖度，初始冠层覆盖度。该参数是种植密度与单个作物幼苗的冠层覆盖度的乘积。
* CGC：冠层生长系数（作物冠层覆盖每天增长的比例）。
* $CC_x$：最大冠层覆盖度，在该种植密度且最优条件下达到。
* CDC：冠层衰减系数（作物冠层覆盖度每天减小的比例）。
此外，还需要知道作物冠层开始衰老的时间。
<img src=".\Figs\Fig3.4a.png" width="500px" />


















